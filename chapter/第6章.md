# 第六章：決策樹模型

## 6.1 決策樹的基礎概念

### 什麼是決策樹？
- 決策樹是一種基於分裂規則進行預測的機器學習模型，其結構類似於一棵樹，由節點和分支組成。
- **基本結構**：
  1. **根節點（Root Node）**：樹的起點，包含所有數據。
  2. **內部節點（Internal Node）**：每個節點執行特徵的分割規則。
  3. **葉節點（Leaf Node）**：最終的決策輸出。

### 決策樹的兩種主要應用：
1. **分類樹（Classification Tree）**：用於分類任務，葉節點輸出類別標籤。
2. **回歸樹（Regression Tree）**：用於回歸任務，葉節點輸出連續值。

---

## 6.2 決策樹的構建過程

### 決策樹的核心問題
1. **如何選擇分割點？**
   - 根據某些指標（如信息增益、基尼指數或方差減少）選擇最優的特徵和分割點。
2. **何時停止分割？**
   - 當滿足停止條件（如葉節點數據數量過少或最大深度限制）時停止分割。

---

### 常見分割標準
#### **1. 信息增益（Information Gain）**
- 用於分類樹。
- 衡量分割後數據的不確定性降低了多少。
- 計算公式：
  \[
  \text{Information Gain} = \text{Entropy(Parent)} - \sum_{i} \frac{n_i}{n} \cdot \text{Entropy(Child}_i\text{)}
  \]
- **例子**：
  - **問題**：選擇「天氣」還是「溫度」作為分割特徵。
  - **解法**：計算兩者的信息增益，選擇增益更高的特徵。

---

#### **2. 基尼指數（Gini Index）**
- 用於分類樹。
- 衡量數據的不純度，數值越小越純。
- 計算公式：
  \[
  G = 1 - \sum_{k=1}^K p_k^2
  \]
  - \(p_k\)：樣本屬於類別 \(k\) 的概率。

---

#### **3. 均方誤差（MSE, Mean Squared Error）**
- 用於回歸樹。
- 衡量分割後的數據集中預測值與真實值的平方誤差。
- 計算公式：
  \[
  \text{MSE} = \frac{1}{n} \sum_{i=1}^n (y_i - \hat{y}_i)^2
  \]

---

### 停止分割的條件
1. **最大深度**：限制決策樹的深度，防止過度分割。
2. **最小樣本數**：限制葉節點的最小樣本數。
3. **信息增益或基尼指數閾值**：當分割後的增益不足時停止。

---

## 6.3 決策樹的葉節點輸出如何確定

### 1. 分類樹葉節點的輸出
- 使用葉節點中樣本數最多的類別作為輸出。
- **例子**：
  - 葉節點包含 5 個類別 A 和 3 個類別 B，輸出為 A。

---

### 2. 回歸樹葉節點的輸出
- 使用葉節點中目標值的平均值作為輸出。
- **例子**：
  - 葉節點的目標值為 [10, 12, 14]，輸出為 (10 + 12 + 14) / 3 = 12。

---

## 6.4 決策樹的優勢與局限

### 優勢
1. **可解釋性強**：分割規則清晰，易於理解和解釋。
2. **適用於多種數據類型**：能處理數值型和類別型特徵。
3. **不需要特徵標準化**：對數據的預處理要求低。

---

### 局限
1. **容易過擬合**：深度過大的樹會導致模型對訓練數據擬合過度。
2. **分裂點選擇的偏差**：對於取值範圍大的特徵可能有偏好。
3. **模型表現一般**：單個決策樹的性能通常不如集成模型（如隨機森林或梯度提升）。

---

## 6.5 決策樹的應用場景

1. **分類問題**
   - 用戶行為分析：根據用戶行為數據判斷是否購買產品。
   - 信用評分：基於個人財務數據評估信用風險。

2. **回歸問題**
   - 房價預測：根據地點、面積等特徵預測房價。
   - 市場需求預測：根據歷史數據估算未來銷量。

---

## 6.6 決策樹的改進模型
1. **隨機森林（Random Forest）**
   - 多棵決策樹的集成，每棵樹隨機選取特徵和樣本進行訓練。
   - 提升穩定性並減少過擬合。

2. **梯度提升（Gradient Boosting）**
   - 在每次迭代中生成一棵新的決策樹，修正前一棵樹的預測誤差。
   - 提升預測精度。

---

## 總結
本章系統地介紹了決策樹的基本概念、構建過程、葉節點輸出的確定方法，以及其優勢和局限。決策樹是一種直觀且強大的模型，但在某些應用中可能需要改進模型（如隨機森林或梯度提升）來提升性能。
